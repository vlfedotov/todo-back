from logging import getLogger, basicConfig, INFO
from aiohttp import web

from .views import (
    IndexView,
    TodoView,
)


basicConfig(level=INFO)
logger = getLogger(__name__)


def get_app(loop):
    app = web.Application(loop=loop)

    app.router.add_route('*', '/', IndexView.dispatch)
    app.router.add_route('*', '/{uuid}', TodoView.dispatch)

    return app


async def init(loop):
    app = get_app(loop)
    
    logger.info("Starting server at %s:%s", IP, PORT)
    srv = await loop.create_server(app.make_handler(), IP, PORT)
    return srv
